<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Panel - Brainrot Farm Monitor</title>
    <link rel="icon" type="image/jpeg" href="/favicon.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css?v=13">
    <!-- Inline critical loading styles -->
    <style>
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f14 0%, #1a1a24 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .loading-logo {
            font-size: 3rem;
            color: #6366f1;
            margin-bottom: 1.5rem;
            animation: pulse 1.5s ease-in-out infinite;
        }
        .loading-title {
            font-size: 1.5rem;
            color: #ffffff;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .loading-subtitle {
            color: #a0a0b0;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #2a2a3a;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen (shown immediately) -->
    <div id="loadingScreen" class="loading-screen">
        <i class="fas fa-seedling loading-logo"></i>
        <div class="loading-title">Farmer Panel</div>
        <div class="loading-subtitle">Loading your farm data...</div>
        <div class="loading-spinner"></div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen hidden">
        <div class="login-container">
            <div class="login-header">
                <i class="fas fa-seedling login-icon"></i>
                <h1>Farmer Panel</h1>
                <p>Enter your farm key to access the panel</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="input-group">
                    <i class="fas fa-key"></i>
                    <input type="text" id="farmKeyInput" placeholder="FARM-XXXX-XXXX-XXXX-XXXX" autocomplete="off" spellcheck="false">
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Access Panel
                </button>
                <div id="loginError" class="login-error"></div>
            </form>
            <div class="login-footer">
                <p>Your farm key is generated by the farm script</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app hidden">
        <header class="header">
            <div class="header-left">
                <i class="fas fa-seedling"></i>
                <h1>Farmer Panel</h1>
            </div>
            <div class="header-center">
                <nav class="nav-tabs">
                    <button class="nav-tab active" data-view="dashboard">
                        <i class="fas fa-chart-line"></i>
                        Dashboard
                    </button>
                    <button class="nav-tab" data-view="top">
                        <i class="fas fa-trophy"></i>
                        Top
                    </button>
                    <button class="nav-tab" data-view="accounts">
                        <i class="fas fa-users"></i>
                        Accounts
                    </button>
                    <button class="nav-tab" data-view="farmers">
                        <i class="fas fa-key"></i>
                        Farm Keys
                    </button>
                    <button class="nav-tab" data-view="collection">
                        <i class="fas fa-layer-group"></i>
                        Collection
                    </button>
                    <button class="nav-tab" data-view="offers">
                        <i class="fas fa-store"></i>
                        Offers
                    </button>
                </nav>
            </div>
            <div class="header-right">
                <div class="account-switcher" id="accountSwitcher">
                    <div class="current-farmer-wrapper" id="currentFarmerWrapper">
                        <div class="current-farmer" id="currentFarmer"></div>
                        <div class="farmer-stats-mini">
                            <span class="farmer-balance" id="farmerBalance">$0.00</span>
                            <span class="farmer-accounts-count" id="farmerAccountsCount">0 accounts</span>
                        </div>
                        <i class="fas fa-chevron-down switcher-arrow"></i>
                    </div>
                    <div class="account-dropdown hidden" id="accountDropdownPanel">
                        <div class="account-dropdown-header">
                            <span>Switch Account</span>
                        </div>
                        <div class="account-dropdown-list" id="accountDropdownList"></div>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- Dashboard View -->
            <div id="dashboardView" class="view active">
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalAccounts">0</div>
                            <div class="stat-label">Total Accounts</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-circle" style="color: #4ade80;"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="onlineAccounts">0</div>
                            <div class="stat-label">Online</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-coins"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalIncome">$0/s</div>
                            <div class="stat-label">Combined Income</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-brain"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalBrainrots">0</div>
                            <div class="stat-label">Total Brainrots</div>
                        </div>
                    </div>
                    <div class="stat-card stat-value-card">
                        <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalValue">$0.00</div>
                            <div class="stat-label">Est. Value <span id="totalValueChange" class="value-change"></span></div>
                        </div>
                    </div>
                </div>
                
                <!-- Balance Chart -->
                <div class="balance-chart-section" id="balanceChartSection">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> Balance History</h3>
                        <div class="chart-period-tabs">
                            <button class="period-tab" data-period="300000">RT</button>
                            <button class="period-tab" data-period="3600000">1H</button>
                            <button class="period-tab active" data-period="86400000">24H</button>
                            <button class="period-tab" data-period="604800000">7D</button>
                            <button class="period-tab" data-period="2592000000">30D</button>
                        </div>
                    </div>
                    <div class="chart-container" id="balanceChartContainer">
                        <canvas id="balanceChart"></canvas>
                        <div class="chart-empty" id="chartEmpty">
                            <i class="fas fa-clock"></i>
                            <p>Collecting data...</p>
                        </div>
                    </div>
                    <div class="chart-stats" id="chartStats"></div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-users"></i>
                        Active Farmers
                    </h2>
                    <div class="accounts-grid" id="accountsGrid"></div>
                </div>
            </div>

            <!-- Top View -->
            <div id="topView" class="view">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-trophy"></i>
                        Leaderboards
                    </h2>
                    <div class="top-tabs">
                        <button class="top-tab active" data-top="income">
                            <i class="fas fa-coins"></i>
                            Best Income Brainrot
                        </button>
                        <button class="top-tab" data-top="value">
                            <i class="fas fa-gem"></i>
                            Most Valuable Brainrot
                        </button>
                        <button class="top-tab" data-top="total">
                            <i class="fas fa-chart-bar"></i>
                            Total Panel Income
                        </button>
                    </div>
                    <div class="top-content" id="topContent">
                        <!-- Top content will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Accounts View -->
            <div id="accountsView" class="view">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-list"></i>
                        All Accounts
                    </h2>
                    <div class="accounts-list" id="accountsList"></div>
                </div>
            </div>

            <!-- Collection View -->
            <div id="collectionView" class="view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-layer-group"></i>
                            All Brainrots
                        </h2>
                        <div class="collection-stats" id="collectionStats"></div>
                    </div>
                    <div class="collection-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="brainrotSearch" placeholder="Search by name or income (e.g. 100, >50, <200)..." autocomplete="off">
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="clearPriceCache()" title="Refresh prices from Eldorado">
                            <i class="fas fa-sync-alt"></i> Refresh Prices
                        </button>
                        <div class="filter-group">
                            <div class="custom-dropdown" id="sortDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span>Income: High to Low</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="income-desc">Income: High to Low</div>
                                    <div class="dropdown-item" data-value="income-asc">Income: Low to High</div>
                                    <div class="dropdown-item" data-value="price-desc">Price: High to Low</div>
                                    <div class="dropdown-item" data-value="price-asc">Price: Low to High</div>
                                    <div class="dropdown-item" data-value="name-asc">Name: A-Z</div>
                                    <div class="dropdown-item" data-value="name-desc">Name: Z-A</div>
                                    <div class="dropdown-item" data-value="account">By Account</div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="priceFilterDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span>All Prices</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="all">All Prices</div>
                                    <div class="dropdown-item" data-value="has-price">Has Price</div>
                                    <div class="dropdown-item" data-value="no-price">No Price</div>
                                    <div class="dropdown-item" data-value="under-1">Under $1</div>
                                    <div class="dropdown-item" data-value="1-5">$1 - $5</div>
                                    <div class="dropdown-item" data-value="5-10">$5 - $10</div>
                                    <div class="dropdown-item" data-value="10-25">$10 - $25</div>
                                    <div class="dropdown-item" data-value="over-25">Over $25</div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="accountDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span>All Accounts</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu" id="accountDropdownMenu">
                                    <div class="dropdown-item active" data-value="all">All Accounts</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="brainrots-grid" id="brainrotsGrid"></div>
                </div>
            </div>

            <!-- Farm Keys View -->
            <div id="farmersView" class="view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-key"></i>
                            Saved Farm Keys
                        </h2>
                        <button class="add-key-btn" id="addKeyBtn">
                            <i class="fas fa-plus"></i>
                            Add Key
                        </button>
                    </div>
                    <div class="farm-keys-list" id="farmKeysList"></div>
                </div>
            </div>

            <!-- Offers View -->
            <div id="offersView" class="view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-store"></i>
                            Eldorado Offers
                        </h2>
                        <div class="offers-stats" id="offersStats"></div>
                    </div>
                    <div class="offers-controls">
                        <div class="offers-bulk-actions">
                            <label class="checkbox-wrapper bulk-select-all">
                                <input type="checkbox" id="selectAllOffers">
                                <span class="checkmark"></span>
                                <span>Select All</span>
                            </label>
                            <button class="btn btn-secondary btn-sm" id="bulkAdjustBtn" disabled>
                                <i class="fas fa-edit"></i>
                                Adjust Selected
                            </button>
                        </div>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="offerSearch" placeholder="Search offers by name or ID..." autocomplete="off">
                        </div>
                        <div class="filter-group">
                            <div class="custom-dropdown" id="offerSortDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span>Newest First</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="newest">Newest First</div>
                                    <div class="dropdown-item" data-value="oldest">Oldest First</div>
                                    <div class="dropdown-item" data-value="price-desc">Price: High to Low</div>
                                    <div class="dropdown-item" data-value="price-asc">Price: Low to High</div>
                                    <div class="dropdown-item" data-value="diff-desc">Diff %: High to Low</div>
                                    <div class="dropdown-item" data-value="diff-asc">Diff %: Low to High</div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="offerStatusDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span>All Offers</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="all">All Offers</div>
                                    <div class="dropdown-item" data-value="active">Active</div>
                                    <div class="dropdown-item" data-value="paused">Paused</div>
                                    <div class="dropdown-item" data-value="needs-update">Needs Price Update</div>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-sm" id="scanOffersBtn" title="Scan Eldorado and refresh offers">
                            <i class="fas fa-satellite-dish"></i>
                            Scan & Refresh
                        </button>
                        <!-- Offers scan progress bar -->
                        <div class="offers-scan-progress hidden" id="offersScanProgress">
                            <div class="offers-scan-progress-bar">
                                <div class="offers-scan-progress-fill" id="offersScanProgressFill"></div>
                            </div>
                            <span class="offers-scan-progress-text" id="offersScanProgressText">0%</span>
                        </div>
                        <a href="https://www.eldorado.gg/dashboard/offers?category=CustomItem" target="_blank" class="btn btn-secondary btn-sm" title="Open Eldorado Dashboard">
                            <i class="fas fa-external-link-alt"></i>
                            Eldorado
                        </a>
                    </div>
                    <div class="offers-grid" id="offersGrid"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mass Select FAB Button (outside mainApp for fixed positioning) -->
    <button class="mass-select-fab" id="massSelectFab" title="Массовый выбор для генерации">
        <i class="fas fa-layer-group"></i>
    </button>
    
    <!-- Mass Select Indicator -->
    <div class="mass-select-indicator" id="massSelectIndicator">
        <span>Выбрано: <span class="mass-select-count" id="massSelectCount">0</span></span>
        <button class="mass-select-generate-btn" id="massSelectGenerateBtn" disabled>
            <i class="fas fa-wand-magic-sparkles"></i> Генерировать
        </button>
    </div>

    <!-- Add Key Modal -->
    <div id="addKeyModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Add Farm Key</h3>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <i class="fas fa-key"></i>
                    <input type="text" id="newKeyInput" placeholder="FARM-XXXX-XXXX-XXXX-XXXX" autocomplete="off">
                </div>
                <div id="modalError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddKey">Cancel</button>
                <button class="btn btn-primary" id="confirmAddKey">
                    <i class="fas fa-plus"></i>
                    Add Key
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Username Modal -->
    <div id="editUsernameModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Username</h3>
                <button class="modal-close" id="closeUsernameModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="usernameInput" placeholder="Enter new username" autocomplete="off" maxlength="20">
                </div>
                <p class="input-hint">3-20 characters, letters, numbers and underscore only</p>
                <div id="usernameError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditUsername">Cancel</button>
                <button class="btn btn-primary" id="confirmEditUsername">
                    <i class="fas fa-save"></i>
                    Save
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Price Adjust Modal -->
    <div id="bulkPriceModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-tags"></i> Adjust Prices</h3>
                <button class="modal-close" id="closeBulkPriceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="bulk-price-options">
                    <div class="bulk-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="bulkPriceType" value="recommended" checked>
                            <span class="radiomark"></span>
                            <span>Set to Recommended Price</span>
                        </label>
                        <p class="option-hint">Use market-based recommended price for each offer</p>
                    </div>
                    <div class="bulk-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="bulkPriceType" value="custom-single">
                            <span class="radiomark"></span>
                            <span>Set Single Custom Price</span>
                        </label>
                        <p class="option-hint">Apply the same price to all selected offers</p>
                        <div class="bulk-custom-input hidden" id="singlePriceInput">
                            <div class="input-group compact">
                                <span>$</span>
                                <input type="number" step="0.01" min="0" id="singleCustomPrice" placeholder="0.00">
                            </div>
                        </div>
                    </div>
                    <div class="bulk-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="bulkPriceType" value="custom-each">
                            <span class="radiomark"></span>
                            <span>Set Individual Prices</span>
                        </label>
                        <p class="option-hint">Set custom price for each offer individually</p>
                    </div>
                </div>
                <div class="bulk-offers-list" id="bulkOffersList"></div>
                <div id="bulkPriceError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelBulkPrice">Cancel</button>
                <button class="btn btn-primary" id="confirmBulkPrice">
                    <i class="fas fa-check"></i>
                    Apply Changes (<span id="bulkCount">0</span> offers)
                </button>
            </div>
        </div>
    </div>

    <!-- Single Offer Price Adjust Modal -->
    <div id="offerPriceModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-tag"></i> Adjust Offer Price</h3>
                <button class="modal-close" id="closeOfferPriceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="offer-preview" id="offerPreview"></div>
                <div class="price-options">
                    <div class="price-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="priceType" value="recommended" checked>
                            <span class="radiomark"></span>
                            <span>Recommended: <strong id="recommendedPriceValue">$0.00</strong></span>
                        </label>
                    </div>
                    <div class="price-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="priceType" value="custom">
                            <span class="radiomark"></span>
                            <span>Custom Price:</span>
                        </label>
                        <div class="input-group compact inline">
                            <span>$</span>
                            <input type="number" step="0.01" min="0" id="customPriceInput" placeholder="0.00">
                        </div>
                    </div>
                </div>
                <div id="offerPriceError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelOfferPrice">Cancel</button>
                <button class="btn btn-primary" id="confirmOfferPrice">
                    <i class="fas fa-external-link-alt"></i>
                    Update on Eldorado
                </button>
            </div>
        </div>
    </div>

    <!-- Mass Generation Modal -->
    <div id="massGenerationModal" class="modal mass-gen-modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-layer-group"></i> Массовая генерация</h3>
                <button class="modal-close" id="closeMassGenModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="mass-gen-list" id="massGenList">
                    <!-- Items will be rendered here -->
                </div>
                <div class="mass-gen-progress hidden" id="massGenProgress">
                    <div class="mass-gen-progress-bar">
                        <div class="mass-gen-progress-fill" id="massGenProgressFill" style="width: 0%"></div>
                    </div>
                    <div class="mass-gen-progress-text">
                        <span id="massGenProgressText">0 / 0</span>
                        <span id="massGenProgressPercent">0%</span>
                    </div>
                </div>
                <div id="massGenError" class="modal-error hidden"></div>
                <div id="massGenActions" class="mass-gen-actions hidden">
                    <button id="massGenDownloadAll" class="mass-gen-download-btn">
                        <i class="fas fa-download"></i>
                        Скачать все
                    </button>
                    <button id="massGenStartEldorado" class="mass-gen-eldorado-btn">
                        <i class="fas fa-store"></i>
                        Выложить на Eldorado
                    </button>
                </div>
                <p class="mass-gen-footer-info" id="massGenFooterInfo">
                    <i class="fas fa-info-circle"></i> 
                    После генерации нажмите "Выложить на Eldorado" для создания офферов
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMassGen">Отмена</button>
                <button class="btn btn-primary" id="startMassGen">
                    <i class="fas fa-wand-magic-sparkles"></i>
                    <span id="massGenBtnText">Генерировать</span>
                </button>
            </div>
        </div>
    </div>

    <script src="app.js?v=35"></script>
</body>
</html>


