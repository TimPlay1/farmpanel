<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Panel - Brainrot Farm Monitor</title>
    <link rel="icon" type="image/jpeg" href="/favicon.jpg">
    <!-- DNS prefetch и preconnect для быстрого соединения -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <!-- Preload критических ресурсов -->
    <link rel="preload" href="/brainrots-mapping.json" as="fetch" crossorigin>
    <link rel="preload" href="styles.css?v=15" as="style">
    <link rel="preload" href="app.js" as="script">
    <!-- Стили -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <link rel="stylesheet" href="styles.css?v=15">
    <!-- Inline critical loading styles -->
    <style>
        :root {
            --bg-primary: #0f0f14;
            --bg-secondary: #16161d;
            --accent-primary: #6366f1;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --border-color: #2a2a3a;
        }
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .loading-logo {
            font-size: 3rem;
            color: var(--accent-primary);
            margin-bottom: 1.5rem;
            animation: pulse 1.5s ease-in-out infinite;
        }
        .loading-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .loading-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
    </style>
    <!-- Apply saved theme BEFORE page renders to prevent flash -->
    <script>
        (function() {
            const THEMES = {
                dark: { bgPrimary: '#0f0f14', bgSecondary: '#16161d', accentPrimary: '#6366f1', textPrimary: '#ffffff', textSecondary: '#a0a0b0', borderColor: '#2a2a3a' },
                light: { bgPrimary: '#f5f5f7', bgSecondary: '#ffffff', accentPrimary: '#6366f1', textPrimary: '#1a1a1a', textSecondary: '#4a4a4a', borderColor: '#d1d1d6' },
                purple: { bgPrimary: '#1a1025', bgSecondary: '#231432', accentPrimary: '#a855f7', textPrimary: '#ffffff', textSecondary: '#c9b8db', borderColor: '#4a2d6e' },
                green: { bgPrimary: '#0a1410', bgSecondary: '#0f1f18', accentPrimary: '#22c55e', textPrimary: '#ffffff', textSecondary: '#a8d4b8', borderColor: '#2a5040' }
            };
            const saved = localStorage.getItem('farmerPanel_theme');
            const theme = THEMES[saved] || THEMES.dark;
            const root = document.documentElement;
            root.style.setProperty('--bg-primary', theme.bgPrimary);
            root.style.setProperty('--bg-secondary', theme.bgSecondary);
            root.style.setProperty('--accent-primary', theme.accentPrimary);
            root.style.setProperty('--text-primary', theme.textPrimary);
            root.style.setProperty('--text-secondary', theme.textSecondary);
            root.style.setProperty('--border-color', theme.borderColor);
        })();
    </script>
</head>
<body>
    <!-- Loading Screen (shown immediately) -->
    <div id="loadingScreen" class="loading-screen">
        <i class="fas fa-seedling loading-logo"></i>
        <div class="loading-title">Farmer Panel</div>
        <div class="loading-subtitle" data-i18n="loading_data">Loading your farm data...</div>
        <div class="loading-spinner"></div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen hidden">
        <div class="login-container">
            <div class="login-header">
                <i class="fas fa-seedling login-icon"></i>
                <h1>Farmer Panel</h1>
                <p data-i18n="login_subtitle">Enter your farm key to access the panel</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="input-group">
                    <i class="fas fa-key"></i>
                    <input type="text" id="farmKeyInput" placeholder="FARM-XXXX-XXXX-XXXX-XXXX" autocomplete="off" spellcheck="false">
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    <span data-i18n="access_panel">Access Panel</span>
                </button>
                <div id="loginError" class="login-error"></div>
            </form>
            <div class="login-footer">
                <p data-i18n="login_footer">Your farm key is generated by the farm script</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app hidden">
        <header class="header">
            <div class="header-left">
                <i class="fas fa-seedling"></i>
                <h1>Farmer Panel</h1>
            </div>
            <div class="header-center">
                <nav class="nav-tabs">
                    <button class="nav-tab active" data-view="dashboard">
                        <i class="fas fa-chart-line"></i>
                        <span data-i18n="nav_dashboard">Dashboard</span>
                    </button>
                    <button class="nav-tab" data-view="top">
                        <i class="fas fa-trophy"></i>
                        <span data-i18n="nav_top">Top</span>
                    </button>
                    <button class="nav-tab" data-view="accounts">
                        <i class="fas fa-users"></i>
                        <span data-i18n="nav_accounts">Accounts</span>
                    </button>
                    <button class="nav-tab" data-view="farmers">
                        <i class="fas fa-key"></i>
                        <span data-i18n="nav_farm_keys">Farm Keys</span>
                    </button>
                    <button class="nav-tab" data-view="collection">
                        <i class="fas fa-layer-group"></i>
                        <span data-i18n="nav_collection">Collection</span>
                    </button>
                    <button class="nav-tab" data-view="offers">
                        <i class="fas fa-store"></i>
                        <span data-i18n="nav_offers">Offers</span>
                    </button>
                </nav>
            </div>
            <div class="header-right">
                <div class="account-switcher" id="accountSwitcher">
                    <div class="current-farmer-wrapper" id="currentFarmerWrapper">
                        <div class="current-farmer" id="currentFarmer"></div>
                        <div class="farmer-stats-mini">
                            <span class="farmer-balance" id="farmerBalance">$0.00</span>
                            <span class="farmer-accounts-count" id="farmerAccountsCount">0 accounts</span>
                        </div>
                        <i class="fas fa-chevron-down switcher-arrow"></i>
                    </div>
                    <div class="account-dropdown hidden" id="accountDropdownPanel">
                        <div class="account-dropdown-header">
                        <span data-i18n="switch_account">Switch Account</span>
                        </div>
                        <div class="account-dropdown-list" id="accountDropdownList"></div>
                    </div>
                </div>
                <button class="settings-btn" id="settingsBtn" data-i18n-title="settings">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="logout-btn" id="logoutBtn" data-i18n-title="logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- Dashboard View -->
            <div id="dashboardView" class="view active">
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalAccounts">0</div>
                            <div class="stat-label" data-i18n="total_accounts">Total Accounts</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-circle" style="color: #4ade80;"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="onlineAccounts">0</div>
                            <div class="stat-label" data-i18n="online">Online</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-coins"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalIncome">$0/s</div>
                            <div class="stat-label" data-i18n="combined_income">Combined Income</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-brain"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalBrainrots">0</div>
                            <div class="stat-label" data-i18n="total_brainrots">Total Brainrots</div>
                        </div>
                    </div>
                    <div class="stat-card stat-value-card">
                        <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalValue">$0.00</div>
                            <div class="stat-label"><span data-i18n="est_value">Est. Value</span> <span id="totalValueChange" class="value-change"></span></div>
                        </div>
                    </div>
                </div>
                
                <!-- Balance Chart -->
                <div class="balance-chart-section" id="balanceChartSection">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> <span data-i18n="balance_history">Balance History</span></h3>
                        <div class="chart-period-tabs">
                            <button class="period-tab" data-period="300000">RT</button>
                            <button class="period-tab" data-period="3600000">1H</button>
                            <button class="period-tab active" data-period="86400000">24H</button>
                            <button class="period-tab" data-period="604800000">7D</button>
                            <button class="period-tab" data-period="2592000000">30D</button>
                        </div>
                    </div>
                    <div class="chart-container" id="balanceChartContainer">
                        <canvas id="balanceChart"></canvas>
                        <div class="chart-empty" id="chartEmpty">
                            <i class="fas fa-clock"></i>
                            <p data-i18n="collecting_data">Collecting data...</p>
                        </div>
                    </div>
                    <div class="chart-stats" id="chartStats"></div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-users"></i>
                        <span data-i18n="active_farmers">Active Farmers</span>
                    </h2>
                    <div class="accounts-grid" id="accountsGrid"></div>
                </div>
            </div>

            <!-- Top View -->
            <div id="topView" class="view">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-trophy"></i>
                        <span data-i18n="leaderboards">Leaderboards</span>
                    </h2>
                    <div class="top-tabs">
                        <button class="top-tab active" data-top="income">
                            <i class="fas fa-coins"></i>
                            <span data-i18n="best_income_brainrot">Best Income Brainrot</span>
                        </button>
                        <button class="top-tab" data-top="value">
                            <i class="fas fa-gem"></i>
                            <span data-i18n="most_valuable_brainrot">Most Valuable Brainrot</span>
                        </button>
                        <button class="top-tab" data-top="total">
                            <i class="fas fa-chart-bar"></i>
                            <span data-i18n="total_panel_income">Total Panel Income</span>
                        </button>
                    </div>
                    <div class="top-content" id="topContent">
                        <!-- Top content will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Accounts View -->
            <div id="accountsView" class="view">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-list"></i>
                        <span data-i18n="all_accounts">All Accounts</span>
                    </h2>
                    <div class="accounts-list" id="accountsList"></div>
                </div>
            </div>

            <!-- Collection View -->
            <div id="collectionView" class="view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-layer-group"></i>
                            <span data-i18n="all_brainrots">All Brainrots</span>
                        </h2>
                        <div class="collection-stats" id="collectionStats"></div>
                    </div>
                    <div class="collection-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="brainrotSearch" data-i18n-placeholder="search_placeholder" placeholder="Search by name or income (e.g. 100, >50, <200)..." autocomplete="off">
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="clearPriceCache()" data-i18n-title="refresh_prices_title">
                            <i class="fas fa-sync-alt"></i> <span data-i18n="refresh_prices">Refresh Prices</span>
                        </button>
                        <div class="filter-group">
                            <div class="custom-dropdown" id="priceTypeDropdown">
                                <button class="dropdown-toggle price-type-toggle" type="button" title="Choose which price to display as recommended">
                                    <i class="fas fa-tag"></i>
                                    <span data-i18n="suggested">Suggested</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="suggested">
                                        <i class="fas fa-tag"></i> <span data-i18n="suggested_default">Suggested (Default)</span>
                                    </div>
                                    <div class="dropdown-item" data-value="median">
                                        <i class="fas fa-chart-bar"></i> <span data-i18n="median">Median</span>
                                    </div>
                                    <div class="dropdown-item" data-value="nextCompetitor">
                                        <i class="fas fa-arrow-up"></i> <span data-i18n="next_competitor">Next Competitor</span>
                                    </div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="sortDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span data-i18n="income_high_low">Income: High to Low</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="income-desc" data-i18n="income_high_low">Income: High to Low</div>
                                    <div class="dropdown-item" data-value="income-asc" data-i18n="income_low_high">Income: Low to High</div>
                                    <div class="dropdown-item" data-value="price-desc" data-i18n="price_high_low">Price: High to Low</div>
                                    <div class="dropdown-item" data-value="price-asc" data-i18n="price_low_high">Price: Low to High</div>
                                    <div class="dropdown-item" data-value="name-asc" data-i18n="name_az">Name: A-Z</div>
                                    <div class="dropdown-item" data-value="name-desc" data-i18n="name_za">Name: Z-A</div>
                                    <div class="dropdown-item" data-value="account" data-i18n="by_account">By Account</div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="priceFilterDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span data-i18n="all_prices">All Prices</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="all" data-i18n="all_prices">All Prices</div>
                                    <div class="dropdown-item" data-value="has-price" data-i18n="has_price">Has Price</div>
                                    <div class="dropdown-item" data-value="no-price" data-i18n="no_price">No Price</div>
                                    <div class="dropdown-item" data-value="under-1" data-i18n="under_1">Under $1</div>
                                    <div class="dropdown-item" data-value="1-5">$1 - $5</div>
                                    <div class="dropdown-item" data-value="5-10">$5 - $10</div>
                                    <div class="dropdown-item" data-value="10-25">$10 - $25</div>
                                    <div class="dropdown-item" data-value="over-25" data-i18n="over_25">Over $25</div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="accountDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span data-i18n="all_accounts">All Accounts</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu" id="accountDropdownMenu">
                                    <div class="dropdown-item active" data-value="all" data-i18n="all_accounts">All Accounts</div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="mutationFilterDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span data-i18n="all_mutations">All Mutations</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="all" data-i18n="all_mutations">All Mutations</div>
                                    <div class="dropdown-item" data-value="none" data-i18n="no_mutation">No Mutation</div>
                                    <div class="dropdown-item" data-value="any" data-i18n="any_mutation">Any Mutation</div>
                                    <div class="dropdown-item" data-value="Gold"><span class="mutation-badge gold">Gold</span></div>
                                    <div class="dropdown-item" data-value="Diamond"><span class="mutation-badge diamond">Diamond</span></div>
                                    <div class="dropdown-item" data-value="Radioactive"><span class="mutation-badge radioactive">Radioactive</span></div>
                                    <div class="dropdown-item" data-value="Rainbow"><span class="mutation-badge rainbow">Rainbow</span></div>
                                    <div class="dropdown-item" data-value="Galaxy"><span class="mutation-badge galaxy">Galaxy</span></div>
                                    <div class="dropdown-item" data-value="Bloodrot"><span class="mutation-badge bloodrot">Bloodrot</span></div>
                                    <div class="dropdown-item" data-value="Candy"><span class="mutation-badge candy">Candy</span></div>
                                    <div class="dropdown-item" data-value="Lava"><span class="mutation-badge lava">Lava</span></div>
                                    <div class="dropdown-item" data-value="Yin-Yang"><span class="mutation-badge yin-yang">Yin-Yang</span></div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="listedFilterDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span data-i18n="all_status">All Status</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="all" data-i18n="all_status">All Status</div>
                                    <div class="dropdown-item" data-value="listed"><i class="fas fa-shopping-cart"></i> <span data-i18n="listed">Listed</span></div>
                                    <div class="dropdown-item" data-value="not-listed"><i class="fas fa-box-open"></i> <span data-i18n="not_listed">Not Listed</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="brainrots-grid" id="brainrotsGrid"></div>
                </div>
            </div>

            <!-- Farm Keys View -->
            <div id="farmersView" class="view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-key"></i>
                            <span data-i18n="saved_farm_keys">Saved Farm Keys</span>
                        </h2>
                        <button class="add-key-btn" id="addKeyBtn">
                            <i class="fas fa-plus"></i>
                            <span data-i18n="add_key">Add Key</span>
                        </button>
                    </div>
                    <div class="farm-keys-list" id="farmKeysList"></div>
                </div>
            </div>

            <!-- Offers View -->
            <div id="offersView" class="view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-store"></i>
                            <span data-i18n="eldorado_offers">Eldorado Offers</span>
                        </h2>
                        <div class="offers-stats" id="offersStats"></div>
                    </div>
                    
                    <!-- Shop Name Section -->
                    <div class="shop-name-section" id="shopNameSection">
                        <div class="shop-name-display">
                            <span class="shop-name-label" data-i18n="your_shop">Your Shop:</span>
                            <span class="shop-name-value" id="shopNameValue" data-i18n="not_configured">Not configured</span>
                            <button class="btn btn-icon btn-sm edit-shop-name" id="editShopNameBtn" data-i18n-title="edit_shop_name">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-icon btn-sm" id="generatorSettingsBtn" data-i18n-title="generator_settings">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                        <div class="shop-name-hint" id="shopNameHint">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span data-i18n="configure_shop_hint">Configure your shop name to create offers</span>
                        </div>
                    </div>
                    
                    <!-- Universal Code System Info Banner -->
                    <div class="offers-info-banner" id="offersInfoBanner">
                        <div class="info-banner-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="info-banner-text">
                            <strong data-i18n="universal_tracking">Universal Tracking System:</strong> 
                            <span data-i18n="universal_tracking_desc">Codes are auto-generated when you create offers through the panel. 
                            The scanner automatically detects and tracks your offers on Eldorado.</span>
                        </div>
                        <button class="info-banner-close" id="closeInfoBanner"><i class="fas fa-times"></i></button>
                    </div>
                    
                    <div class="offers-controls">
                        <div class="offers-bulk-actions">
                            <label class="checkbox-wrapper bulk-select-all">
                                <input type="checkbox" id="selectAllOffers">
                                <span class="checkmark"></span>
                                <span data-i18n="select_all">Select All</span>
                            </label>
                            <button class="btn btn-secondary btn-sm" id="bulkAdjustBtn" disabled>
                                <i class="fas fa-edit"></i>
                                <span data-i18n="adjust_selected">Adjust Selected</span>
                            </button>
                            <button class="btn btn-danger btn-sm hidden" id="bulkDeleteBtn">
                                <i class="fas fa-trash"></i>
                                <span data-i18n="delete_selected">Delete Selected</span>
                            </button>
                        </div>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="offerSearch" data-i18n-placeholder="search_offers_placeholder" placeholder="Search offers by name or code..." autocomplete="off">
                        </div>
                        <div class="filter-group">
                            <div class="custom-dropdown" id="offerSortDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span data-i18n="newest_first">Newest First</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="newest" data-i18n="newest_first">Newest First</div>
                                    <div class="dropdown-item" data-value="oldest" data-i18n="oldest_first">Oldest First</div>
                                    <div class="dropdown-item" data-value="price-desc" data-i18n="price_high_low">Price: High to Low</div>
                                    <div class="dropdown-item" data-value="price-asc" data-i18n="price_low_high">Price: Low to High</div>
                                    <div class="dropdown-item" data-value="diff-desc" data-i18n="diff_high_low">Diff %: High to Low</div>
                                    <div class="dropdown-item" data-value="diff-asc" data-i18n="diff_low_high">Diff %: Low to High</div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="offerStatusDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span data-i18n="all_offers">All Offers</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="all" data-i18n="all_offers">All Offers</div>
                                    <div class="dropdown-item" data-value="active" data-i18n="active_on_eldorado">Active (on Eldorado)</div>
                                    <div class="dropdown-item" data-value="pending" data-i18n="pending_not_found">Pending (not found yet)</div>
                                    <div class="dropdown-item" data-value="paused" data-i18n="paused">Paused</div>
                                    <div class="dropdown-item" data-value="needs-update" data-i18n="needs_price_update">Needs Price Update</div>
                                    <div class="dropdown-item" data-value="in-stock" data-i18n="in_stock">In Stock (have in collection)</div>
                                    <div class="dropdown-item" data-value="out-of-stock" data-i18n="out_of_stock">Out of Stock (0 in collection)</div>
                                </div>
                            </div>
                            <div class="custom-dropdown" id="offerMutationDropdown">
                                <button class="dropdown-toggle" type="button">
                                    <span data-i18n="all_mutations">All Mutations</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <div class="dropdown-item active" data-value="all" data-i18n="all_mutations">All Mutations</div>
                                    <div class="dropdown-item" data-value="none" data-i18n="no_mutation">No Mutation</div>
                                    <div class="dropdown-item" data-value="any" data-i18n="any_mutation">Any Mutation</div>
                                    <div class="dropdown-item" data-value="Gold"><span class="mutation-badge gold">Gold</span></div>
                                    <div class="dropdown-item" data-value="Diamond"><span class="mutation-badge diamond">Diamond</span></div>
                                    <div class="dropdown-item" data-value="Radioactive"><span class="mutation-badge radioactive">Radioactive</span></div>
                                    <div class="dropdown-item" data-value="Rainbow"><span class="mutation-badge rainbow">Rainbow</span></div>
                                    <div class="dropdown-item" data-value="Galaxy"><span class="mutation-badge galaxy">Galaxy</span></div>
                                    <div class="dropdown-item" data-value="Bloodrot"><span class="mutation-badge bloodrot">Bloodrot</span></div>
                                    <div class="dropdown-item" data-value="Candy"><span class="mutation-badge candy">Candy</span></div>
                                    <div class="dropdown-item" data-value="Lava"><span class="mutation-badge lava">Lava</span></div>
                                    <div class="dropdown-item" data-value="Yin-Yang"><span class="mutation-badge yinyang">Yin-Yang</span></div>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-sm" id="scanOffersBtn" data-i18n-title="scan_all_title">
                            <i class="fas fa-satellite-dish"></i>
                            <span data-i18n="scan_all">Scan All</span>
                        </button>
                        <!-- Offers scan progress bar -->
                        <div class="offers-scan-progress hidden" id="offersScanProgress">
                            <div class="offers-scan-progress-bar">
                                <div class="offers-scan-progress-fill" id="offersScanProgressFill"></div>
                            </div>
                            <span class="offers-scan-progress-text" id="offersScanProgressText">0%</span>
                        </div>
                        <a href="https://www.eldorado.gg/dashboard/offers?category=CustomItem" target="_blank" class="btn btn-secondary btn-sm" title="Open Eldorado Dashboard">
                            <i class="fas fa-external-link-alt"></i>
                            Eldorado
                        </a>
                    </div>
                    <div class="offers-grid" id="offersGrid"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mass Select FAB Button (outside mainApp for fixed positioning) -->
    <button class="mass-select-fab" id="massSelectFab" data-i18n-title="mass_select_title">
        <i class="fas fa-layer-group"></i>
    </button>
    
    <!-- Mass Select Indicator -->
    <div class="mass-select-indicator" id="massSelectIndicator">
        <span><span data-i18n="selected">Selected:</span> <span class="mass-select-count" id="massSelectCount">0</span></span>
        <button class="mass-select-generate-btn" id="massSelectGenerateBtn" disabled>
            <i class="fas fa-wand-magic-sparkles"></i> <span data-i18n="generate">Generate</span>
        </button>
    </div>

    <!-- Add Key Modal -->
    <div id="addKeyModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> <span data-i18n="add_farm_key">Add Farm Key</span></h3>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <i class="fas fa-key"></i>
                    <input type="text" id="newKeyInput" placeholder="FARM-XXXX-XXXX-XXXX-XXXX" autocomplete="off">
                </div>
                <div id="modalError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddKey" data-i18n="cancel">Cancel</button>
                <button class="btn btn-primary" id="confirmAddKey">
                    <i class="fas fa-plus"></i>
                    <span data-i18n="add_key">Add Key</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Username Modal -->
    <div id="editUsernameModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> <span data-i18n="edit_username">Edit Username</span></h3>
                <button class="modal-close" id="closeUsernameModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="usernameInput" data-i18n-placeholder="enter_new_username" placeholder="Enter new username" autocomplete="off" maxlength="20">
                </div>
                <p class="input-hint" data-i18n="username_hint">3-20 characters, letters, numbers and underscore only</p>
                <div id="usernameError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditUsername" data-i18n="cancel">Cancel</button>
                <button class="btn btn-primary" id="confirmEditUsername">
                    <i class="fas fa-save"></i>
                    <span data-i18n="save">Save</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Price Adjust Modal -->
    <div id="bulkPriceModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-tags"></i> <span data-i18n="bulk_price_adjustment">Bulk Price Adjustment</span></h3>
                <button class="modal-close" id="closeBulkPriceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="bulk-price-type-selector">
                    <div class="bulk-price-type-option" data-type="recommended">
                        <input type="radio" name="bulkPriceType" value="recommended" id="bulkType_recommended" checked>
                        <label for="bulkType_recommended">
                            <i class="fas fa-tag"></i>
                            <span class="type-name" data-i18n="recommended">Recommended</span>
                            <span class="type-hint" data-i18n="market_based_price">Market-based optimal price</span>
                        </label>
                    </div>
                    <div class="bulk-price-type-option" data-type="median">
                        <input type="radio" name="bulkPriceType" value="median" id="bulkType_median">
                        <label for="bulkType_median">
                            <i class="fas fa-chart-bar"></i>
                            <span class="type-name" data-i18n="median">Median</span>
                            <span class="type-hint" data-i18n="median_from_competitor">Median from competitor page</span>
                        </label>
                    </div>
                    <div class="bulk-price-type-option" data-type="nextCompetitor">
                        <input type="radio" name="bulkPriceType" value="nextCompetitor" id="bulkType_nextComp">
                        <label for="bulkType_nextComp">
                            <i class="fas fa-arrow-up"></i>
                            <span class="type-name" data-i18n="next_competitor">Next Competitor</span>
                            <span class="type-hint" data-i18n="next_competitor_price">Price of next competitor</span>
                        </label>
                    </div>
                    <div class="bulk-price-type-option" data-type="custom-single">
                        <input type="radio" name="bulkPriceType" value="custom-single" id="bulkType_single">
                        <label for="bulkType_single">
                            <i class="fas fa-edit"></i>
                            <span class="type-name" data-i18n="custom">Custom</span>
                            <span class="type-hint" data-i18n="individual_prices">Individual prices</span>
                        </label>
                    </div>
                </div>
                <div class="bulk-offers-list" id="bulkOffersList"></div>
                <div id="bulkPriceError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelBulkPrice" data-i18n="cancel">Cancel</button>
                <button class="btn btn-primary" id="confirmBulkPrice">
                    <i class="fas fa-check"></i>
                    <span data-i18n="apply_changes">Apply Changes</span> (<span id="bulkCount">0</span> <span data-i18n="offers">offers</span>)
                </button>
            </div>
        </div>
    </div>

    <!-- Single Offer Price Adjust Modal -->
    <div id="offerPriceModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-tag"></i> <span data-i18n="adjust_offer_price">Adjust Offer Price</span></h3>
                <button class="modal-close" id="closeOfferPriceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="offer-preview" id="offerPreview"></div>
                <!-- v9.11.4: Mutation variant selector -->
                <div id="offerVariantSelector" class="offer-variant-selector hidden"></div>
                <div class="price-options">
                    <div class="price-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="priceType" value="recommended" checked>
                            <span class="radiomark"></span>
                            <span class="price-option-label">
                                <i class="fas fa-tag"></i>
                                <span data-i18n="recommended">Recommended</span>: <strong id="recommendedPriceValue">$0.00</strong>
                            </span>
                        </label>
                    </div>
                    <div class="price-option median-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="priceType" value="median">
                            <span class="radiomark"></span>
                            <span class="price-option-label">
                                <i class="fas fa-chart-bar" style="color: #60a5fa;"></i>
                                <span data-i18n="median">Median</span>: <strong id="medianPriceValue">$0.00</strong>
                            </span>
                        </label>
                    </div>
                    <div class="price-option next-comp-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="priceType" value="nextCompetitor">
                            <span class="radiomark"></span>
                            <span class="price-option-label">
                                <i class="fas fa-arrow-up" style="color: #4ade80;"></i>
                                <span data-i18n="next_competitor">Next Competitor</span>: <strong id="nextCompetitorPriceValue">$0.00</strong>
                            </span>
                        </label>
                    </div>
                    <div class="price-option custom-price-option">
                        <label class="radio-wrapper">
                            <input type="radio" name="priceType" value="custom">
                            <span class="radiomark"></span>
                            <span data-i18n="custom_price">Custom Price:</span>
                        </label>
                        <div class="custom-price-wrapper-modal">
                            <div class="input-group compact inline">
                                <span>$</span>
                                <input type="number" step="0.01" min="0" id="customPriceInput" placeholder="0.00">
                            </div>
                            <span class="current-price-hint" id="currentPriceHint">(<span data-i18n="current">current</span>: <strong id="currentPriceHintValue">$0.00</strong>)</span>
                        </div>
                    </div>
                </div>
                <div id="offerPriceError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelOfferPrice" data-i18n="cancel">Cancel</button>
                <button class="btn btn-primary" id="confirmOfferPrice">
                    <i class="fas fa-external-link-alt"></i>
                    <span data-i18n="update_on_eldorado">Update on Eldorado</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Mass Generation Modal -->
    <div id="massGenerationModal" class="modal mass-gen-modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-layer-group"></i> <span data-i18n="mass_generation">Mass Generation</span></h3>
                <button class="modal-close" id="closeMassGenModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="mass-gen-global-price-selector">
                    <label><i class="fas fa-tag"></i> <span data-i18n="price_type_for_all">Price type for all:</span></label>
                    <select id="massGenGlobalPriceType" class="mass-gen-global-select">
                        <option value="">Individual</option>
                        <option value="suggested">💰 Recommended</option>
                        <option value="median">📊 Median</option>
                        <option value="nextCompetitor">⬆️ Next Competitor</option>
                    </select>
                </div>
                <div class="mass-gen-list" id="massGenList">
                    <!-- Items will be rendered here -->
                </div>
                <div class="mass-gen-progress hidden" id="massGenProgress">
                    <div class="mass-gen-progress-bar">
                        <div class="mass-gen-progress-fill" id="massGenProgressFill" style="width: 0%"></div>
                    </div>
                    <div class="mass-gen-progress-text">
                        <span id="massGenProgressText">0 / 0</span>
                        <span id="massGenProgressPercent">0%</span>
                    </div>
                </div>
                <div id="massGenError" class="modal-error hidden"></div>
                <div id="massGenActions" class="mass-gen-actions hidden">
                    <button id="massGenDownloadAll" class="mass-gen-download-btn">
                        <i class="fas fa-download"></i>
                        <span data-i18n="download_all">Download All</span>
                    </button>
                    <button id="massGenStartEldorado" class="mass-gen-eldorado-btn">
                        <i class="fas fa-store"></i>
                        <span data-i18n="post_to_eldorado">Post to Eldorado</span>
                    </button>
                </div>
                <p class="mass-gen-footer-info" id="massGenFooterInfo">
                    <i class="fas fa-info-circle"></i> 
                    <span data-i18n="mass_gen_footer">After generation click "Post to Eldorado" to create offers</span>
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMassGen" data-i18n="cancel">Cancel</button>
                <button class="btn btn-primary" id="startMassGen">
                    <i class="fas fa-wand-magic-sparkles"></i>
                    <span id="massGenBtnText" data-i18n="generate">Generate</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Shop Name Setup Modal -->
    <div id="shopNameModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-shop-name">
            <div class="modal-header">
                <h3><i class="fas fa-store"></i> <span data-i18n="configure_shop_name">Configure Shop Name</span></h3>
                <button class="modal-close" id="closeShopNameModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-description" data-i18n="shop_name_desc">Your shop name appears in offer titles and descriptions on Eldorado. Format: Emoji + Name + Emoji</p>
                
                <div class="shop-name-builder-new">
                    <div class="emoji-picker-row">
                        <div class="emoji-picker-group">
                            <label data-i18n="left_emoji">Left Emoji</label>
                            <button class="emoji-picker-btn" id="leftEmojiBtn" type="button">
                                <span class="emoji-display" id="leftEmojiDisplay">👾</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <div class="shop-text-input-new">
                            <label><span data-i18n="shop_name">Shop Name</span> <span class="char-counter">(<span id="shopNameCharCount">0</span>/15)</span></label>
                            <input type="text" id="shopNameText" placeholder="Your Shop" maxlength="15">
                        </div>
                        
                        <div class="emoji-picker-group">
                            <label data-i18n="right_emoji">Right Emoji</label>
                            <button class="emoji-picker-btn" id="rightEmojiBtn" type="button">
                                <span class="emoji-display" id="rightEmojiDisplay">👾</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="same-emoji-option">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="sameEmojiCheckbox" checked>
                            <span class="checkmark"></span>
                            <span data-i18n="use_same_emoji">Use same emoji on both sides</span>
                        </label>
                    </div>
                </div>
                
                <div class="shop-name-preview">
                    <label data-i18n="preview">Preview:</label>
                    <div class="preview-box" id="shopNamePreview">👾Your Shop👾</div>
                </div>
                
                <div id="shopNameError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelShopName" data-i18n="cancel">Cancel</button>
                <button class="btn btn-primary" id="confirmShopName">
                    <i class="fas fa-save"></i>
                    <span data-i18n="save_shop_name">Save Shop Name</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Generator Settings Modal -->
    <div id="generatorSettingsModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> <span data-i18n="generator_settings_title">Generator Settings</span></h3>
                <button class="modal-close" id="closeGeneratorSettingsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-description" data-i18n="generator_settings_desc">Configure your image generator template. Leave empty to use the default template.</p>
                
                <div class="input-group">
                    <label for="templateIdInput" data-i18n="supa_template_id">Supa Template ID</label>
                    <input type="text" id="templateIdInput" placeholder="21157229 (default)" autocomplete="off">
                    <small class="input-hint" data-i18n="template_hint">Enter your custom Supa.ru template ID or leave empty for default</small>
                </div>
                
                <div id="generatorSettingsError" class="modal-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelGeneratorSettings" data-i18n="cancel">Cancel</button>
                <button class="btn btn-primary" id="confirmGeneratorSettings">
                    <i class="fas fa-save"></i>
                    <span data-i18n="save_settings">Save Settings</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Emoji Picker Popup -->
    <div id="emojiPickerPopup" class="emoji-picker-popup hidden">
        <div class="emoji-picker-header">
            <span data-i18n="select_emoji">Select Emoji</span>
            <button class="emoji-picker-close" id="closeEmojiPicker"><i class="fas fa-times"></i></button>
        </div>
        <div class="emoji-picker-search">
            <input type="text" id="emojiSearchInput" data-i18n-placeholder="search_emoji" placeholder="Search emoji...">
        </div>
        <div class="emoji-picker-grid" id="emojiPickerGrid">
            <!-- Emojis will be populated by JavaScript -->
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> <span data-i18n="settings_title">Settings</span></h3>
                <button class="modal-close" id="closeSettingsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body settings-modal-body">
                <!-- Language Selection -->
                <div class="settings-section">
                    <h4><i class="fas fa-language"></i> <span data-i18n="language">Language</span></h4>
                    <div class="settings-options">
                        <button class="settings-option-btn" data-lang="en">
                            <span class="option-flag"><img src="https://flagcdn.com/w40/us.png" alt="US" width="24" height="16"></span>
                            <span class="option-label">English</span>
                        </button>
                        <button class="settings-option-btn" data-lang="ru">
                            <span class="option-flag"><img src="https://flagcdn.com/w40/ru.png" alt="RU" width="24" height="16"></span>
                            <span class="option-label">Русский</span>
                        </button>
                    </div>
                </div>
                
                <!-- Theme Selection -->
                <div class="settings-section">
                    <h4><i class="fas fa-palette"></i> <span data-i18n="theme">Theme</span></h4>
                    <div class="settings-options theme-options">
                        <button class="settings-option-btn theme-btn" data-theme="dark">
                            <span class="theme-preview theme-preview-dark"></span>
                            <span class="option-label" data-i18n="theme_dark">Dark</span>
                        </button>
                        <button class="settings-option-btn theme-btn" data-theme="light">
                            <span class="theme-preview theme-preview-light"></span>
                            <span class="option-label" data-i18n="theme_light">Light</span>
                        </button>
                        <button class="settings-option-btn theme-btn" data-theme="purple">
                            <span class="theme-preview theme-preview-purple"></span>
                            <span class="option-label" data-i18n="theme_purple">Purple</span>
                        </button>
                        <button class="settings-option-btn theme-btn" data-theme="green">
                            <span class="theme-preview theme-preview-green"></span>
                            <span class="option-label" data-i18n="theme_green">Green</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js?v=65"></script>
</body>
</html>